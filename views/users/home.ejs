<%- include ('../partials/user-header.ejs') %>

    <main class="mt-3" style="height: auto;">
        <div class="mt-5">
            <div id="carouselExampleCaptions" class="carousel slide ms-auto me-auto" data-bs-ride="carousel"
                style="width: 60%;">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active"
                        aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1"
                        aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2"
                        aria-label="Slide 3"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="\images\others\toy1a.jpg" class="d-block w-100" alt="...">
                        <div class="carousel-caption d-none d-md-block text-dark fw-bolder fs-3">
                            <p>One stop shop for TOYZZ....</p>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="\images\others\toy2a.jpg" class="d-block w-100" alt="...">
                        <div class="carousel-caption d-none d-md-block text-dark fw-bolder fs-3">
                            <p>Variety Toys For Your Kids</p>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="\images\others\toy3a.jpg" class="d-block w-100" alt="...">
                        <div class="carousel-caption d-none d-md-block text-dark fw-bolder fs-3">
                            <p>Exciting Offers Available</p>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions"
                    data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions"
                    data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        <div class="side-margin mt-5">
            <div class="col-5 bg-dark-grn w-100 rounded"
                style="display: flex; justify-content: center; align-items: center; height: 50px;">
                <div>
                    <h2 class="content-head-txt">PRODUCTS</h2>
                </div>
            </div>
        </div>
        <div>
            <% if(products.length==0) {%>
                <div class="content-body side-margin text-start mt-3 card-container product-container"
                    style="display: flex; min-height: 50vh;">
                    <h3 style="justify-content: center;">No product available</h3>
                </div>
                <% } else { %>
                    <div class="content-body side-margin text-start mt-3 card-container product-container">
                        <% for( let i=0;i<Math.min(5,products.length);i++ ) { %>
                            <a href="/products/<%= products[i].productCode %>" style="text-decoration: none;"
                                class="col-dark-grn">
                                <div class="card cards product-card">
                                    <div class="card-content">
                                        <img src="/images/<%= products[i].productImages[0] %>"
                                            class="card-img-top p-3 border" alt="...">
                                        <div class="card-body p-3 text-center col-dark-grn">
                                            <h4 class="card-title">
                                                <%= products[i].productName %>
                                            </h4>
                                            <h6 class="card-text">Price: <%= products[i].price %>
                                            </h6>
                                            <span class="card-text">Minimum Age: <%= products[i].minimumAge %></span>
                                            <span class="card-text">
                                                <%= products[i].productDescription %>
                                            </span>
                                            <div class="col-dark-grn ps-3 pe-3 mt-3"
                                                style="display: flex; justify-content: space-between; align-items: center;">
                                                <button style="color: white; z-index: 3;"
                                                    class="btn bg-dark-grn buy-now-btn" type="button"
                                                    data-product-code="<%= products[i].productCode %>">BUY
                                                    NOW</button>
                                                <button style="color: white; z-index: 3;"
                                                    class="btn bg-dark-grn add-to-cart-btn" type="button"
                                                    data-product-code="<%= products[i].productCode %>"><i
                                                        class="fa-solid fa-cart-shopping"></i></button>
                                                <button style="color: white; z-index: 3;"
                                                    class="btn bg-dark-grn wish-list-btn" type="button"
                                                    data-product-code="<%= products[i].productCode %>"><i
                                                        class="fa-regular fa-heart"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            <% } %>
                    </div>
                    <div class="mt-3" style="display: flex; justify-content: center;">
                        <a href="/products">
                            <button style="color: white;" class="btn bg-dark-grn" type="submit">VIEW ALL</button>
                        </a>
                    </div>
                    <% } %>
        </div>
        <div class="mt-5 side-margin">
            <div class="col-5 bg-dark-grn w-100 rounded"
                style="display: flex; justify-content: center; align-items: center; height: 50px;">
                <div>
                    <h2 class="content-head-txt">CATEGORIES</h2>
                </div>
            </div>
        </div>
        <div>
            <% if(categories.length==0) {%>
                <div class="content-body side-margin text-start mt-3 card-container product-container"
                    style="min-height: 50vh; display: flex;">
                    <h3>No category available</h3>
                </div>
                <% } else { %>
                    <div class="content-body side-margin text-start mt-3 card-container product-container"
                        style="min-height: auto;">
                        <% for( let i=0;i<Math.min(5,categories.length);i++ ) { %>
                            <a href="/categories/<%= categories[i].categoryName %>" style="text-decoration: none;"
                                class="col-dark-grn">
                                <div class="card cards">
                                    <div class="card-content">
                                        <img src="/images/<%= categories[i].categoryImage %>" class="card-img-top"
                                            alt="...">
                                        <div class="card-body p-3 text-center col-dark-grn">
                                            <h4 class="card-title">
                                                <%= categories[i].categoryName %>
                                            </h4>
                                            <p class="card-text category-text">
                                                <%= categories[i].categoryDescription %>
                                            </p>
                                            <div class="col-dark-grn" style="display: flex; justify-content: center;">
                                                <!-- <a href="#"> -->
                                                <button style="color: white; z-index: 3;" class="btn bg-dark-grn"
                                                    type="submit">VIEW</button>
                                                <!-- </a> -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            <% } %>
                    </div>
                    <div class="mt-3" style="display: flex; justify-content: center;">
                        <a href="/categories">
                            <button style="color: white;" class="btn bg-dark-grn" type="submit">VIEW ALL</button>
                        </a>
                    </div>
                    <% } %>
        </div>
        <div class="side-margin mt-5">
            <div class="banner">
                <div class="banner-content">
                    <h1>FESTIVAL COUPONS !</h1>
                    <p>For every festivals</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Buy now button handling
        let buyNow = document.querySelectorAll('.buy-now-btn');
        buyNow.forEach(button => {
            button.addEventListener('click', (event) => {
                event.preventDefault();
                event.stopPropagation();
                const productCode = button.getAttribute('data-product-code');
                window.location.href = `/add-to-cart/${productCode}`;
            });
        });


        // Add to Cart button click event handling
        let addToCart = document.querySelectorAll('.add-to-cart-btn');
        addToCart.forEach(button => {
            button.addEventListener("click", (e) => {
                e.preventDefault();
                e.stopPropagation();

                const productCode = button.getAttribute('data-product-code');
                const user = "<%= user %>";

                if (user.length > 0) {
                    fetch(`/add-to-cart`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ productCode })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                toastr.info('Added to Cart!');
                                document.getElementById("cart-count").textContent = data.cartCountNew;
                            } else {
                                toastr.warning(data.message);
                            }
                        })
                        .catch(error => {
                            console.error("Error:", error);
                        });
                } else {
                    fetch(`/add-to-cart`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/html' }
                    })
                        .then(response => response.text())
                        .then(html => {
                            document.documentElement.innerHTML = html;
                        })
                        .catch(error => console.log('Error loading page:', error));
                }
            })
        })


        // add to wishlist button handling
        let wishList = document.querySelectorAll('.wish-list-btn');
        wishList.forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();

                const productCode = button.getAttribute('data-product-code');
                const user_id = '<%= user %>';
                if (user_id.length > 0) {

                    fetch(`/addToWishList`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ productCode })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                toastr.info('Added to wishlist!');
                            } else {
                                toastr.warning(data.message);
                            }
                        })
                        .catch(error => {
                            console.error("Error:", error);
                        });

                } else {

                    fetch(`/addToWishList`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/html' },
                    }).then(response => response.text())
                        .then(html => {
                            document.documentElement.innerHTML = html;
                        })
                        .catch(error => console.log('Error loading page:', error));

                }
            })
        })
    </script>

    <%- include ('../partials/user-footer.ejs') %>